/**
 * @file
 * @brief Interface between CPP and C
 * @details Implements new, new[], delete and delete[] operators
 *		MUST NOT be included from C code
 * @ToDo add a debug feature to trace using inappropriate operators pair call
 *	- new => delete[]
 *	- new[] => delete
 *
 * @date 25.06.2012
 * @author Vladimir Sokolov
 */

#ifndef CPP_NEW_
#define CPP_NEW_

#ifndef __cplusplus
#	error This file can be used only from CPP code
#endif

extern "C" {
#	include <stdlib.h>
#	include <assert.h>
};


inline void* operator new(long unsigned int n) {
	size_t m = n;
	static_assert(sizeof(size_t) >= sizeof(long unsigned int));
	return malloc(m);
}

inline void* operator new[](long unsigned int n) {
	size_t m = n;
	static_assert(sizeof(size_t) >= sizeof(long unsigned int));
	return malloc(m);
}


inline void operator delete(void* p) {
	free(p);
}

inline void operator delete[](void* p) {
	free(p);
}


#endif /* CPP_NEW_ */


