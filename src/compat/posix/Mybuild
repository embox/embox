package embox.compat.posix

module LibPosix {

	depends embox.compat.posix.util.All
	depends embox.compat.posix.proc.All
	depends embox.compat.posix.idx.All
	depends file
	depends fs
}

static module fs {
	@IncludePath("$(SRC_DIR)/compat/posix/include")
	source "fs.c"

	depends embox.kernel.task.errno
}

static module file_ops {
	@IncludePath("$(SRC_DIR)/compat/posix/include")
	source "file_ops.c"

	depends embox.kernel.task.api
	depends embox.kernel.task.idx_table
	depends embox.kernel.task.errno
	depends posix_env
	depends io_sync_api
}

module file {
	depends file_ops
	depends open_api
}

@DefaultImpl(open)
abstract module open_api{ }

static module open extends open_api {
	source "open.c"

	depends embox.fs.posix_compat
	depends embox.kernel.task.errno
}

static module no_open extends open {
	source "no_open.c"
}

module posix_env {
	@IncludePath("$(SRC_DIR)/compat/posix/include")
	source "env/bs_posix_env.c"

	depends embox.kernel.task.api
	depends embox.compat.posix.idx.dup
}

@DefaultImpl(io_sync_simple)
abstract module io_sync_api {
	depends embox.kernel.irq_lock
}

module io_sync_simple extends io_sync_api {
	source "io_sync_simple.c"
}

module io_sync extends io_sync_api {
	source "io_sync.c"
	depends embox.kernel.thread.event
}
