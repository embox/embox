package embox.fs

module node {
	source "node.c"
	option number fnode_quantity=64
}

module filesystem {
	source "file_system.c"
	source "mount_table.c"
	option number fs_quantity=32

	depends embox.fs.driver.repo
}

module file_desc {
	source "file_desc.c"
	option number fdesc_quantity=32
}

@DefaultImpl(NoFileSystem)
abstract module fs_api {

}

module NoFileSystem extends fs_api{
	depends SysLibFsNone
	depends SysLibFileSystemNone
}

module xattr {
	source "xattr.c"
}

module core extends fs_api {
	source "vfs.c", "path.c"

	depends embox.compat.posix.fs.fsop
	depends file_desc, node
	depends embox.fs.driver.repo

	depends embox.fs.SysLibFsFull
	depends embox.kernel.task.api //vfs_get_leaf: environment should be initialized
	depends filesystem
}

module index_operation {
	source "index_operation.c"
	depends fs_api
	depends embox.kernel.task.idx_table
}

module rootfs {
	source "rootfs.c"
	option string fstype = "initfs"
	option string src = ""
	option string dst = "/"
	depends node, driver.repo
	depends embox.fs.filesystem
	depends SysLibFileSystem
	depends embox.lib.LibC
}

module journal {
	source "journal.c"

	depends embox.lib.LibC
	depends buffer_cache
	depends embox.mem.slab
}

module buffer_cache {
	source "bcache.c"
	option number bcache_size=128

	depends embox.lib.LibC
	depends embox.mem.pool
	depends embox.kernel.thread.mutex

	depends embox.mem.heap_api

	@NoRuntime depends embox.util.hashtable
}
