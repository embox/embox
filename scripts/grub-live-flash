
EMBOX_MULTIBOOT=./build/base/bin/embox

MOUNT_POINT=/media/embox-live

DATA_DIR=$(dirname $0)/grub/

usage() {
	echo "Make grub live usb."
	echo
	echo "Usage:"
	echo "    $0 <device>"
	echo "<device> is dev file of flash."
	echo
	echo "Example:"
	echo "    $0 /dev/sdb"
}

grub1_do () {
	DRIVE=$1
	grub-install --root-directory=$MOUNT_POINT $DRIVE

	cp $DATA_DIR/grub1-config $MOUNT_POINT/boot/grub/menu.lst
	cp $EMBOX_MULTIBOOT $MOUNT_POINT/boot/embox

}



if [ ! $# = 1 ]; then
	usage
	exit 1
fi

DRIVE=$1
PARTITION=${DRIVE}1
[ -d $MOUNT_POINT ] || mkdir $MOUNT_POINT
umount $PARTITION
echo ",,L" | sfdisk $DRIVE
mke2fs $PARTITION
mount $PARTITION $MOUNT_POINT
grub1_do $1 $MOUNT_POINT

umount $MOUNT_POINT
rmdir $MOUNT_POINT

